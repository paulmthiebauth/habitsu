<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="/js/chart.js"></script>
<link href='http://fonts.googleapis.com/css?family=Quicksand:300,400,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Pinyon+Script' rel='stylesheet' type='text/css'>
<%= csrf_meta_tags %>

<div class="row">

  <div class="large-4 columns">
    <div class="stats">
      <div class="quote">
        <h3>Todays Mantra</h3>
        <br>
        Help others achieve their dreams and you will achieve yours.<br>
        -Les Brown
      </div>
      <div class="graph">
        <div>
          <h3>Daily Completion Rates</h3><br>
        </div>
        <div  id="container"></div>
      </div>
    </div>
  </div>

  <div class="large-4 columns">
    <div class="todo">
      <h3>To Do List</h3>
      <div class="tasksdate">
        <ul class="inline-list">
          <li><div class="navbutton"><%= link_to image_tag("/leftarrow.png"), user_path(current_user, q: @current_page += 1 ) %></div></li>
          <% @current_page -= 1 %>
          <li><%= (@current_page).days.ago.strftime('%a %B %e, %Y') %></li>

          <% if @current_page >= 1 %>
            <li><div class="navbutton"><%= link_to image_tag("/rightarrow.png"), user_path(current_user, q: @current_page -= 1 ) %></div></li>
            <% @current_page += 1 %>
          <% end %>
        </ul>
      </div>

      <% if @current_page == 0 %>
        <div class="new-task">

          <%= form_for [@user, @task] do |f| %>
            <div class="task_name">
              <%= f.text_field :name, size: 10%>
              <div class="task_submit">
                <%= f.submit "+" %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

      <div class="tasks">
        <% @tasks.each do |task|%>
          <% if task.completed_at.nil? %>
            <% if Time.now - task.created_at > 800 %>
              <%= task.name %><br>
              <img src="http://s9.postimg.org/ddnnijb97/reminder16.png"  height="18px" width="18px"> : <%= link_to "Complete", complete_task_path(task.id), method: :patch%><br><br>
            <% else %>
              <%= task.name %><br><%= link_to "Complete", complete_task_path(task.id), method: :patch %><br><br>
            <% end %>
          <% else %>
            <div class="complete-task">
              <%= task.name %><br>
              <%= link_to image_tag("/check16.png"), incomplete_task_path(task.id), method: :patch, data: { confirm: "Mark this task as incomplete?" }%>: <%= task.created_at.strftime('%A %B %e, %Y') %><br>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="large-4 columns">
    <div class="habit">
      <div>
        <h3>Habit Checklist</h3>
      </div><br>
      <div id="habitlist2">
        <div>
          <% @plans.each do |plan|%>
            <div class="planname">
              <%= plan.plan_name %>
            </div>
            <% if @habits.empty? %>
            <% else %>
              <% @habits.each do |habit| %>
              <!-- <div class="habitlist"> -->
                  <% if habit.plan_id == plan.id && habit.date >= Time.zone.now.beginning_of_day %>
                    <% if habit.completed_at.nil? %>

<div id="habit-<%= habit.id %>-complete">
<div class="habitlist">
<%= button_to "", user_dailyhabit_path(@user, habit), id: habit.habit_id, method: :patch, form: { data: {'habit-button' => 'complete'}}, :class => "buttonToComplete" %>
</div>
<div class="habitname">
<%= Habit.find(habit.habit_id).name %>
</div>
</div>
<div id="habit-<%=habit.id %>-incomplete" class="hidden">
<div class="complete-task">
<%= button_to "", user_dailyhabit_path(@user, habit), method: :patch, form: { data: {'habit-button' => 'incomplete'}}, :class => "buttonToIncomplete" %>
<%= Habit.find(habit.habit_id).name %>
</div>
</div>
<% else %>
<div id="habit-<%=habit.id %>-incomplete">
<div class="complete-task">
<%= button_to "", user_dailyhabit_path(@user, habit), method: :patch, form: { data: {'habit-button' => 'incomplete'}}, :class => "buttonToIncomplete" %>
<%= Habit.find(habit.habit_id).name %>
</div>
</div>
<div id="habit-<%= habit.id %>-complete" class="hidden">
<div class="habitlist">
<% random_name = Habit.find(habit.habit_id).name %>
<%= button_to "", user_dailyhabit_path(@user, habit), id: habit.habit_id, habit_name: random_name, method: :patch, form: { data: {'habit-button' => 'complete'}}, :class => "buttonToComplete" %>
<%= Habit.find(habit.habit_id).name %>
</div>
</div>
                    <% end %>
                  <% end %>
                <!-- </div> -->
              <% end %>
            <% end %>
          <% end %>
      </div>
    </div>
  </div>
</div>
